---
title: PWN io_file exploitation
date: 2025-3-10 00:00:00 +0800
categories: [Blog, pwn]
tags: [pwn]
---

oi！小鬼 很火热嘛

## IO相关结构体

进行文件读写操作时，会创建一个结构体`_IO_FILE_plus`：
```c
struct _IO_FILE_plus
{
    _IO_FILE    file; 
    _IO_jump_t   *vtable;  //指向一张虚函数表_IO_jump_t，该表中记录着对文件的各种操作
    //vtable一般都不可修改。vtavle是否可写跟libc有关，有的高版本libc反而可写
}
```
在标准I/O库中，每个程序启动时有三个文件流是自动打开的：stdin、stdout、stderr，分别对应文件描述符0,1,2
```c
pwndbg> p _IO_2_1_stdout_
$4 = {
  file = {
    _flags = -72540028,
    _IO_read_ptr = 0x0, 
    _IO_read_end = 0x0,
    _IO_read_base = 0x0,
    _IO_write_base = 0x0,
    _IO_write_ptr = 0x0,
    _IO_write_end = 0x0,
    _IO_buf_base = 0x0,
    _IO_buf_end = 0x0,
    _IO_save_base = 0x0,
    _IO_backup_base = 0x0,
    _IO_save_end = 0x0,
    _markers = 0x0,
    _chain = 0x7ffff7e1aaa0 <_IO_2_1_stdin_>,
    _fileno = 1,
    _flags2 = 0,
    _old_offset = -1,
    _cur_column = 0,
    _vtable_offset = 0 '\000',
    _shortbuf = "",
    _lock = 0x7ffff7e1ca70 <_IO_stdfile_1_lock>,
    _offset = -1,
    _codecvt = 0x0,
    _wide_data = 0x7ffff7e1a9a0 <_IO_wide_data_1>,
    _freeres_list = 0x0,
    _freeres_buf = 0x0,
    __pad5 = 0,
    _mode = 0,
    _unused2 = '\000' <repeats 19 times>
  },
  vtable = 0x7ffff7e17600 <_IO_file_jumps>
}
```
对于`_IO_jump_t`，有：
```c
struct _IO_jump_t
{
    0x0:JUMP_FIELD(size_t, __dummy);
    0x8:JUMP_FIELD(size_t, __dummy2);
    0x10:JUMP_FIELD(_IO_finish_t, __finish);
    0x18:JUMP_FIELD(_IO_overflow_t, __overflow);
    0x20:JUMP_FIELD(_IO_underflow_t, __underflow);
    0x28:JUMP_FIELD(_IO_underflow_t, __uflow);
    0x30:JUMP_FIELD(_IO_pbackfail_t, __pbackfail);
    0x38:JUMP_FIELD(_IO_xsputn_t, __xsputn);
    0x40:JUMP_FIELD(_IO_xsgetn_t, __xsgetn);
    0x48:JUMP_FIELD(_IO_seekoff_t, __seekoff);
    0x50:JUMP_FIELD(_IO_seekpos_t, __seekpos);
    0x58:JUMP_FIELD(_IO_setbuf_t, __setbuf);
    0x60:JUMP_FIELD(_IO_sync_t, __sync);
    0x68:JUMP_FIELD(_IO_doallocate_t, __doallocate);
    0x70:JUMP_FIELD(_IO_read_t, __read);
    0x78:JUMP_FIELD(_IO_write_t, __write);
    0x80:JUMP_FIELD(_IO_seek_t, __seek);
    0x88:JUMP_FIELD(_IO_close_t, __close);
    0x90:JUMP_FIELD(_IO_stat_t, __stat);
    0x98:JUMP_FIELD(_IO_showmanyc_t, __showmanyc);
    0xa0:JUMP_FIELD(_IO_imbue_t, __imbue);
    #if 0
        get_column;
        set_column;
    #endif

}; 
```

## FSOP

